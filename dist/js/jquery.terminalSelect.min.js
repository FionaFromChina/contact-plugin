!function(t){"use strict";var e={init:function(i){var n={initData:[],contactUrl:"",terminalInfoUrl:"",inputName:"terminals",callback:{}},c=t.extend({},n,i);return t(this).each(function(){t(this).empty();var i=t('<div class="ts-choose-list"><div class="ts-add-input-box"><input class="ts-search-input" id="tsAddInput" type="text" placeholder="这里是placeholder" /> <div class="ts-icon-more"></div> </div> <button class="ts-btn ts-btn-primary ts-btn-confirm">确定</button> </div>'),n=t('<div class="ts-select-list"></div>'),l=t("<input>",{hide:!0,value:"",name:c.inputName});if(t(this).data({settings:c,selectedData:[],inputElm:l}),c.initData.length>0)for(var s=0;s<c.initData.length;s++){var o=c.initData[s];e.addListItem(o,n,t(this))}t(this).append(i).append(n).after(l);var d=t('<div class="nemo-mask-new hide add-item-modal"><div class="inv-add-dialog" > <div class="dialog-bar"> <span class="dialog-title">从企业通讯录邀请</span> <span class="close-btn" >×</span> </div> <div class="content" > <div class="input-search" > <input class="ts-input"> <div class="icon-search" id="searchItem"></div> </div> <div class="choose"> <div class="choose-all choose-all-unchecked">全选</div> </div> <div class="add-list"> </div> </div> <div class="btn-area inv-search-btn-area" > <a class="btn btn-cancel" id="btnCancel" >取消</a> <a class="btn btn-default" id="btnConfirm" >确定</a> </div> </div> </div>');d.data("srcEle",t(this)),d.appendTo("body"),a.init.call(d),e.eventBind.call(t(this),d)})},eventBind:function(i){t(this).data("settings");t(this).on("click",".ts-btn-confirm",function(a){var i=t(a.target).siblings(".ts-add-input-box").children("#tsAddInput").val(),n=t(a.target).parents(".terminal-select"),c=n.data("settings");if(""!==t.trim(c.terminalInfoUrl))try{t.getJSON(c.terminalInfoUrl+i,function(i){var l=i;if(c.callback.onTerminalUrlCalled){var s=c.callback.onTerminalUrlCalled(i);s&&(l=s)}void 0!==l&&("object"!=typeof l||t.isEmptyObject(l)?window.console&&console.log("传入或则返回的数据格式有误,请检查"):(e.addListItem(l,null,n),t(a.target).siblings(".ts-add-input-box").children("#tsAddInput").val("")))}).fail(function(t){window.console&&console.log("获取数据错误")})}catch(t){window.console&&console.log("获取数据错误")}}),t(this).on("click",".ts-list-item-delete",function(a){var i=t(a.target).parent().attr("data-id"),n=t(a.target).parents(".terminal-select"),c=n.data("settings");if(c.callback.beforeDelete){var l=c.callback.beforeDelete(i);if(l===!1)return!1}e.deleteListItem(i,n)}),t(this).on("click",".ts-icon-more",function(t){i.data("isFetched")===!1&&(a.clearData.call(i),a.fetchData.call(i)),a.showDialog.call(i),t.preventDefault()})},addListItem:function(a,i,n){for(var c=n.data("selectedData"),l=0;l<c.length;l++)if(c[l].id===a.id)return;c.push(a);var i=i?i:t(".ts-select-list",n);i.append(t("<div>",{class:"ts-select-item","data-id":a.id,html:"<label>"+a.name+'</label><a class="ts-list-item-delete"></a>'})),e.updateInputDom(c,n)},deleteListItem:function(a,i){for(var n=i.data(),c=0;c<n.selectedData.length;c++)n.selectedData[c].id==a&&n.selectedData.splice(c,1);t(".ts-select-item",i).filter("[data-id="+a+"]").remove(),e.updateInputDom(n.selectedData,i)},getSelected:function(){return t(this).data("selectedData")},updateInputDom:function(t,e){var a=t.map(function(t){return t.id}),i=e.data("inputElm");i.val(a)},selectedData:[]},a={init:function(){t(this).data({isFetched:!1,data:{}}),a.eventInit.call(t(this))},showDialog:function(){t(this).show()},fetchData:function(){var e=t(this),i=t(this).data(),n=t(this).data("srcEle").data("settings");if(i.isFetched===!1){if(""!==t.trim(n.contactUrl))try{t.getJSON(n.contactUrl,function(i){var c=i;if(n.callback.onfetchedUrlCalled){var l=n.callback.onfetchedUrlCalled(i);l&&(c=l)}void 0!==c&&("string"==typeof c||"object"==typeof c?t.extend(e.data(),{isFetched:!0,data:c}):(window.console&&console.log("传入或则返回的数据格式有误,请检查,只接受字符串或者数组类型的数据"),t.extend(e.data(),{isFetched:!0,data:"未能取到数据"})),a.fillModalData(e.data("data"),e))}).fail(function(t){window.console&&(console.log("获取数据错误"),console.log(t))})}catch(t){window.console&&console.log("获取数据错误")}}else a.fillModalData(i.data,e)},clearData:function(){t(".add-list",t(this)).empty()},fillModalData:function(e,a){if("string"==typeof e)return t(".content",a).empty(),void t(".content",a).append(t('<p class="error-info">'+e+"</p>"));var i={nemos:"企业小鱼",users:"企业用户",bruces:"bruces",boxes:"boxes",h323s:"h323s"},n=t("<div>");for(var c in i)if(e[c].length>0){var l=t("<div>",{class:"item-group"}),s=t("<div>",{class:"group-title",html:'<label class="checkbox-uncheck">'+i[c]+"</label>"});l.append(s);for(var o=0;o<e[c].length;o++){var d=e[c][o],r=d.phone?d.phone:d.nemoNumber,h=d.avatar?d.avatar:"//devcdn.ainemo.com/page/images/noicon.png",m=t("<div>",{class:"meeting-contact-item","data-id":d.id,"data-name":d.name,"data-avatar":d.avatar,"data-number":r}),v=t('<img src= "'+h+'" class="item-img">'),p=t("<div>",{class:"item-detail",html:'<label class="item-name">'+d.name+'</label><br><label class="item-phone">'+r+"</label>"});m.append(v).append(p).appendTo(l)}n.append(l)}t(".add-list",a).append(n)},eventInit:function(){function a(t,e){for(var a={},i=0;i<t.length;i++)a[t[i]]=e.attr("data-"+t[i]);return a}var i=t(this);i.on("click","#searchItem",function(e){e.preventDefault();var a=t.trim(t(".ts-input",i).val());t(".item-detail").filter(function(){var e=t(this).children(".item-name"),i=t(this).children(".item-phone");e.html().indexOf(a)>-1||i.html().indexOf(a)>-1?t(this).closest(".meeting-contact-item").show():t(this).closest(".meeting-contact-item").hide()})}),t(".ts-input",i).keypress(function(e){13==e.which&&t("#searchItem",i).click()}),i.on("click",".choose",function(e){t(".choose-all-checked",i).length>0?(t(".choose-all-checked",i).attr("class","choose-all choose-all-unchecked"),t(".meeting-contact-item",i).attr("class","meeting-contact-item")):(t(".choose-all-unchecked",i).attr("class","choose-all choose-all-checked"),t(".meeting-contact-item",i).attr("class","meeting-contact-item meeting-contact-item-checked"))}),i.on("click",".meeting-contact-item",function(e){var a=t(this).closest(".meeting-contact-item");a.hasClass("meeting-contact-item-checked")?a.removeClass("meeting-contact-item-checked"):a.addClass("meeting-contact-item-checked")}),i.on("click","#btnConfirm",function(n){var c=[];t.each(t(".meeting-contact-item-checked",i),function(n,l){var s=a(["id","name","number","avatar"],t(l));e.addListItem(s,null,i.data("srcEle")),c.push(s)});var l=i.data("srcEle").data("settings");l.callback.onSelect&&l.callback.onSelect(c),i.hide()}),i.on("click",".close-btn,#btnCancel",function(t){i.hide()})}};t.fn.terminalSelect=function(a){return e[a]?e[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void t.error(" method  "+a+" is not exist."):e.init.apply(this,arguments)}}(jQuery);